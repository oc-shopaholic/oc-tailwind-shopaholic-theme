title = "Catalog List"
url = "/catalog/:category?"
layout = "main"
is_hidden = 0

[CategoryPage]
slug = "{{ :category }}"
slug_required = 0
smart_url_check = 0

[ProductList]
sorting = "popularity|desc"

[Pagination]
count_per_page = 16
pagination_limit = 5
active_class = "pagination__link_current"
button_list = "first,first-more,main,last-more,last"
first_button_name = "First"
first_button_limit = 3
first_button_number = 1
first-more_button_name = "..."
first-more_button_limit = 4
prev_button_name = "Prev"
prev_button_limit = 1
prev-more_button_name = "..."
prev-more_button_limit = 1
next-more_button_name = "..."
next-more_button_limit = 1
next_button_name = "Next"
next_button_limit = 1
last-more_button_name = "..."
last-more_button_limit = 4
last_button_name = "Last"
last_button_limit = 3
last_button_number = 1
==
function onInit()
{
    $arBreadcrumbs = [
        ['name' => 'Catalog', 'url' => \Cms\Classes\Page::url('product-list', ['category' => false])],
    ];

    $obCategory = $this->CategoryPage->get();

    $sActiveSorting = $this->ProductList->getSorting();
    $iPage = $this->Pagination->getPageFromRequest();
    $obProductList = $this->ProductList->make()->active()->sort($sActiveSorting);
    if (!empty($obCategory)) {
        $arBreadcrumbs[] = ['name' => $obCategory->name, 'url' => $obCategory->getPageUrl('product-list')];
        $obProductList->category($obCategory->id, true);
    }
    $arProductList = $obProductList->page($iPage, $this->Pagination->getCountPerPage());
    $iMaxPage = $this->Pagination->getMaxPage($obProductList->count());

    $this['iMaxPage'] = $iMaxPage;
    $this['iPage'] = $iPage;
    $this['obProductList'] = $obProductList;
    $this['arProductList'] = $arProductList;
    $this['obCategory'] = $obCategory;
    $this['arBreadcrumbs'] = $arBreadcrumbs;
}
?>
==
{##}

{% partial 'breadcrumbs/breadcrumbs' %}
<div class="grid grid-cols-2 gap-x-4 gap-y-6 md:grid-cols-4">
    {% for obProduct in arProductList %}
        {% partial 'product-card/product-card' 
            obProduct = obProduct 
            sLoopIndex = loop.index
            sShowIndex = 8
        %}
    {% endfor %}
</div>
